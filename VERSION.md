# 版本历史

## v0.6.0 - Sprint 5 社区功能 ✅ (2026-02-09)

### 新增功能
- [x] 养护提醒（提醒 / 提醒 植物名称）
- [x] 成长记录（记录 植物名称 内容）
- [x] 养护日历（日历）
- [x] 智能养护周期计算
- [x] 多维度养护状态检查

### 使用示例
```
提醒                  # 查看所有需要养护的植物
提醒 绿萝            # 查看绿萝的详细提醒
记录 绿萝 长出新叶子了  # 记录成长变化
日历                  # 查看最近7天养护记录
```

### 功能说明

**养护提醒**：
- 根据植物类型自动计算养护周期
- 绿植：浇水3天，施肥30天
- 多肉：浇水7天，施肥60天
- 花卉：浇水2天，施肥15天
- 智能提示需要养护的植物

**成长记录**：
- 记录植物成长变化
- 在详情中显示最近3条成长记录
- 支持文字描述

**养护日历**：
- 展示最近7天的养护活动
- 按日期分组显示
- 包含浇水、施肥记录和备注

### 技术实现
- 新增 getCareCycle() 养护周期函数
- 新增 checkCareNeeded() 养护检查函数
- 新增 getCareReminder() 提醒查询函数
- 新增 getAllReminders() 批量提醒函数
- 新增 addGrowthRecord() 成长记录函数
- 新增 getCareCalendar() 日历查询函数

### 数据结构
植物新增 growthRecords 字段：
```javascript
{
  "name": "绿萝",
  "type": "绿植",
  "careRecords": [...],
  "growthRecords": [  // 新增
    {
      "content": "长出新叶子了",
      "date": "2026-02-09T10:30:00"
    }
  ]
}
```

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 待部署测试
- **Git Tag**: v0.6.0
- **回退版本**: v0.5.1（稳定版本）

---

## v0.5.1 - 优化AI识别响应 ✅ (2026-02-09)

### 修复
- [x] 改为同步等待识别结果后再回复
- [x] 解决订阅号无法发送异步消息的问题
- [x] 优化识别结果展示格式

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.5.1

---

## v0.5.0 - Sprint 4 AI 功能 ✅ (2026-02-09)

### 新增功能
- [x] AI 植物识别（发送植物图片）
- [x] 智能养护建议（建议 植物类型）
- [x] 百度 AI 图像识别集成
- [x] 按类型获取专业养护建议

### 使用示例
```
📷 发送植物图片      # AI识别植物
建议 绿植            # 获取绿植养护建议
建议 多肉            # 获取多肉养护建议
建议 花卉            # 获取花卉养护建议
```

### 技术实现
- 集成百度 AI 植物识别 API
- 新增 getBaiduAccessToken() 函数
- 新增 recognizePlant() 图片识别函数
- 新增 getCareAdvice() 养护建议函数
- 支持图片消息类型处理

### 配置说明
需要在 Railway 配置环境变量：
- BAIDU_API_KEY
- BAIDU_SECRET_KEY

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署测试
- **Git Tag**: v0.5.0
- **回退版本**: v0.4.0（稳定版本）

---

## v0.4.0 - Sprint 3.3 综合功能增强 ✅ (2026-02-09)

### 新增功能
- [x] 植物分类（添加 植物名称 类型）
- [x] 养护备注（浇水/施肥 植物名称 备注）
- [x] 数据统计（回复：统计）
- [x] 按类型统计植物数量
- [x] 统计浇水和施肥次数

### 使用示例
```
添加 绿萝 绿植        # 添加植物并指定类型
浇水 绿萝 叶子有点黄  # 浇水并添加备注
施肥 绿萝 复合肥      # 施肥并添加备注
统计                  # 查看数据统计
详情 绿萝            # 查看详情（含备注）
```

### 数据结构
植物新增 type 字段：
```javascript
{
  "name": "绿萝",
  "type": "绿植",  // 新增
  "careRecords": [
    {
      "type": "water",
      "date": "2026-02-09",
      "note": "叶子有点黄"  // 新增
    }
  ]
}
```

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署测试
- **Git Tag**: v0.4.0
- **回退版本**: v0.3.3（稳定版本）

---

## v0.3.3 - 清理代码，确认 Volume 持久化 ✅ (2026-02-09)

### 代码清理
- [x] 移除 PostgreSQL 相关代码（db.js）
- [x] 移除 pg 依赖
- [x] 简化为 Railway Volume + JSON 方案
- [x] 清理配置文档

### 测试结果
✅ Railway Volume 持久化测试通过
✅ 数据在重新部署后保留
✅ 系统稳定运行

### 当前方案
- 数据存储：JSON 文件
- 持久化：Railway Volume (Mount Path: /app/data)
- 环境变量：DATA_DIR=/app/data

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.3.3
- **回退版本**: v0.2.0

---

## v0.3.2 - 使用 PostgreSQL 数据库 ⚠️ (2026-02-09)

### 已废弃
改用 Railway Volume 方案，代码已清理

---

## v0.3.1 - 修复数据持久化问题 ⚠️ (2026-02-09)

### 已废弃
改用 Railway Volume 方案

---

## v0.3.0 - Sprint 3.2 养护记录功能 ✅ (2026-02-09)
- [x] 浇水记录（回复：浇水 植物名称）
- [x] 施肥记录（回复：施肥 植物名称）
- [x] 植物详情（回复：详情 植物名称）
- [x] 养护历史显示（最近5条记录）
- [x] 列表显示最后浇水时间
- [x] 智能时间显示（刚刚/X小时前/X天前）

### 使用示例
```
浇水 绿萝          # 记录浇水
施肥 绿萝          # 记录施肥
详情 绿萝          # 查看养护历史
1                  # 列表显示最后浇水时间
```

### 数据结构
每个植物新增 careRecords 数组：
```javascript
{
  "type": "water",  // water=浇水, fertilize=施肥
  "date": "2026-02-09T10:30:00"
}
```

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署测试
- **Git Tag**: v0.3.0
- **回退版本**: v0.2.0（稳定版本）

---

## v0.2.0 - Sprint 3.1 植物管理功能 🚧 (2026-02-09)

### 新增功能
- [x] JSON 文件数据持久化
- [x] 添加植物功能（回复：添加 植物名称）
- [x] 查看植物列表（回复：1 或 我的植物）
- [x] 删除植物功能（回复：删除 植物名称）
- [x] 用户数据自动初始化

### 使用示例
```
添加 绿萝          # 添加植物
添加 多肉植物      # 添加植物
1                  # 查看列表
我的植物           # 查看列表
删除 绿萝          # 删除植物
```

### 技术实现
- 使用 fs.promises 进行异步文件操作
- 数据存储在 data/users.json
- 每个用户独立的植物列表
- 自动创建数据目录

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署测试
- **Git Tag**: v0.2.0
- **回退版本**: v0.1.7（稳定版本）

---

## v0.1.7 - Sprint 2.6 详细错误诊断 ✅ (2026-02-09)

### 功能
- [x] 增强 access_token 获取的错误日志
- [x] 菜单创建接口返回详细的调试信息
- [x] 显示微信API的完整响应用于诊断

### 结论
- 确认订阅号（未认证）无自定义菜单权限（errcode: 48001）
- 关键词菜单功能完整可用，体验良好
- **当前版本稳定，可作为回退点**

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.1.7

---

## v0.1.6 - Sprint 2.5 配置诊断 ✅ (2026-02-09)

### 功能
- [x] 添加配置检查接口 `/wechat/config/check`
- [x] 帮助用户诊断环境变量配置状态
- [x] 显示AppSecret前8位用于验证

### 使用方法
访问 `https://web-production-61069.up.railway.app/wechat/config/check` 检查配置

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署
- **Git Tag**: v0.1.6

---

## v0.1.5 - Sprint 2.4 关键词菜单 ✅ (2026-02-05)

### 功能
- [x] 关键词菜单系统（替代自定义菜单）
- [x] 支持数字快捷键（0-3）
- [x] 文本消息智能匹配
- [x] 完整的功能导航

### 说明
由于订阅号（未认证）没有自定义菜单权限，改用关键词交互：
- 回复 0 或"菜单" - 显示功能菜单
- 回复 1 或"我的植物" - 植物管理
- 回复 2 或"养护知识" - 养护技巧
- 回复 3 或"关于我们" - 项目信息

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署
- **Git Tag**: v0.1.5

---

## v0.1.4 - Sprint 2.3 自定义菜单尝试 ❌ (2026-02-05)

### 功能
- [x] 微信菜单创建API
- [x] access_token获取
- [x] 菜单配置接口

### 问题
订阅号（未认证）没有自定义菜单权限，功能无法使用

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ❌ 功能受限
- **Git Tag**: v0.1.4

---

## v0.1.3 - Sprint 2.2 增强消息处理 ✅ (2026-02-05)

### 功能
- [x] 关注事件处理
- [x] CLICK事件处理
- [x] 不同消息类型回复

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.1.3

---

## v0.1.2 - Sprint 2.1 消息自动回复 ✅ (2026-02-05)

### 功能
- [x] XML消息解析
- [x] 自动回复功能
- [x] ToUserName/FromUserName正确处理
- [x] 时间戳格式修正

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.1.2

---

## v0.1.0 - Sprint 1 基础框架 ✅ (2026-02-05)

### 功能
- [x] 微信公众号接入验证
- [x] Express服务器框架
- [x] 健康检查接口
- [x] 欢迎页面
- [x] Railway部署成功

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.1.0

### 回退方法
```bash
git checkout v0.1.0
```

---

## 回退策略

### 如果当前版本出现问题：
1. 回退到v0.1.3（最后一个稳定版本）：`git checkout v0.1.3`
2. 在Railway重新部署
3. 或在Railway界面直接回滚到之前的部署

### 测试策略
- 每个新功能先在本地测试
- 确认无误后再部署到Railway
- Railway支持回滚到之前的部署版本