# 版本历史

## v0.3.2 - 使用 PostgreSQL 数据库 🚧 (2026-02-09)

### 问题修复
- [x] 使用 Railway PostgreSQL 数据库持久化
- [x] 创建数据存储适配器（支持 JSON 和 PostgreSQL）
- [x] 自动检测环境，智能切换存储方式
- [x] 本地开发使用 JSON，生产环境使用数据库

### 技术实现
- 新增 db.js 数据存储适配器
- 支持 PostgreSQL 和 JSON 文件双模式
- 自动初始化数据库表
- 事务支持，保证数据一致性

### 配置说明
在 Railway 添加 PostgreSQL 数据库：
1. 点击 "+ New" > "Database" > "Add PostgreSQL"
2. Railway 自动配置 DATABASE_URL
3. 重新部署即可

详见：RAILWAY_POSTGRES_SETUP.md

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待添加数据库
- **Git Tag**: v0.3.2
- **回退版本**: v0.2.0

---

## v0.3.1 - 修复数据持久化问题 ⚠️ (2026-02-09)

### 已知问题
❌ Railway 不支持 Volume（或需要付费）

### 问题修复
- [x] 支持 Railway Volume 持久化存储
- [x] 添加 DATA_DIR 环境变量支持
- [x] 创建 Railway 配置指南

### 技术改进
- 数据目录支持环境变量配置
- 兼容本地开发和生产环境

### 配置说明
需要在 Railway 配置：
1. 添加 Volume: Mount Path = `/app/data`
2. 添加环境变量: DATA_DIR = `/app/data`

详见：RAILWAY_VOLUME_SETUP.md

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待配置 Volume
- **Git Tag**: v0.3.1
- **回退版本**: v0.2.0

---

## v0.3.0 - Sprint 3.2 养护记录功能 ⚠️ (2026-02-09)

### 已知问题
❌ 数据持久化失败（Railway 临时文件系统）

### 新增功能
- [x] 浇水记录（回复：浇水 植物名称）
- [x] 施肥记录（回复：施肥 植物名称）
- [x] 植物详情（回复：详情 植物名称）
- [x] 养护历史显示（最近5条记录）
- [x] 列表显示最后浇水时间
- [x] 智能时间显示（刚刚/X小时前/X天前）

### 使用示例
```
浇水 绿萝          # 记录浇水
施肥 绿萝          # 记录施肥
详情 绿萝          # 查看养护历史
1                  # 列表显示最后浇水时间
```

### 数据结构
每个植物新增 careRecords 数组：
```javascript
{
  "type": "water",  // water=浇水, fertilize=施肥
  "date": "2026-02-09T10:30:00"
}
```

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署测试
- **Git Tag**: v0.3.0
- **回退版本**: v0.2.0（稳定版本）

---

## v0.2.0 - Sprint 3.1 植物管理功能 🚧 (2026-02-09)

### 新增功能
- [x] JSON 文件数据持久化
- [x] 添加植物功能（回复：添加 植物名称）
- [x] 查看植物列表（回复：1 或 我的植物）
- [x] 删除植物功能（回复：删除 植物名称）
- [x] 用户数据自动初始化

### 使用示例
```
添加 绿萝          # 添加植物
添加 多肉植物      # 添加植物
1                  # 查看列表
我的植物           # 查看列表
删除 绿萝          # 删除植物
```

### 技术实现
- 使用 fs.promises 进行异步文件操作
- 数据存储在 data/users.json
- 每个用户独立的植物列表
- 自动创建数据目录

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署测试
- **Git Tag**: v0.2.0
- **回退版本**: v0.1.7（稳定版本）

---

## v0.1.7 - Sprint 2.6 详细错误诊断 ✅ (2026-02-09)

### 功能
- [x] 增强 access_token 获取的错误日志
- [x] 菜单创建接口返回详细的调试信息
- [x] 显示微信API的完整响应用于诊断

### 结论
- 确认订阅号（未认证）无自定义菜单权限（errcode: 48001）
- 关键词菜单功能完整可用，体验良好
- **当前版本稳定，可作为回退点**

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.1.7

---

## v0.1.6 - Sprint 2.5 配置诊断 ✅ (2026-02-09)

### 功能
- [x] 添加配置检查接口 `/wechat/config/check`
- [x] 帮助用户诊断环境变量配置状态
- [x] 显示AppSecret前8位用于验证

### 使用方法
访问 `https://web-production-61069.up.railway.app/wechat/config/check` 检查配置

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署
- **Git Tag**: v0.1.6

---

## v0.1.5 - Sprint 2.4 关键词菜单 ✅ (2026-02-05)

### 功能
- [x] 关键词菜单系统（替代自定义菜单）
- [x] 支持数字快捷键（0-3）
- [x] 文本消息智能匹配
- [x] 完整的功能导航

### 说明
由于订阅号（未认证）没有自定义菜单权限，改用关键词交互：
- 回复 0 或"菜单" - 显示功能菜单
- 回复 1 或"我的植物" - 植物管理
- 回复 2 或"养护知识" - 养护技巧
- 回复 3 或"关于我们" - 项目信息

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: 🚧 待部署
- **Git Tag**: v0.1.5

---

## v0.1.4 - Sprint 2.3 自定义菜单尝试 ❌ (2026-02-05)

### 功能
- [x] 微信菜单创建API
- [x] access_token获取
- [x] 菜单配置接口

### 问题
订阅号（未认证）没有自定义菜单权限，功能无法使用

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ❌ 功能受限
- **Git Tag**: v0.1.4

---

## v0.1.3 - Sprint 2.2 增强消息处理 ✅ (2026-02-05)

### 功能
- [x] 关注事件处理
- [x] CLICK事件处理
- [x] 不同消息类型回复

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.1.3

---

## v0.1.2 - Sprint 2.1 消息自动回复 ✅ (2026-02-05)

### 功能
- [x] XML消息解析
- [x] 自动回复功能
- [x] ToUserName/FromUserName正确处理
- [x] 时间戳格式修正

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.1.2

---

## v0.1.0 - Sprint 1 基础框架 ✅ (2026-02-05)

### 功能
- [x] 微信公众号接入验证
- [x] Express服务器框架
- [x] 健康检查接口
- [x] 欢迎页面
- [x] Railway部署成功

### 部署信息
- **域名**: web-production-61069.up.railway.app
- **状态**: ✅ 稳定运行
- **Git Tag**: v0.1.0

### 回退方法
```bash
git checkout v0.1.0
```

---

## 回退策略

### 如果当前版本出现问题：
1. 回退到v0.1.3（最后一个稳定版本）：`git checkout v0.1.3`
2. 在Railway重新部署
3. 或在Railway界面直接回滚到之前的部署

### 测试策略
- 每个新功能先在本地测试
- 确认无误后再部署到Railway
- Railway支持回滚到之前的部署版本